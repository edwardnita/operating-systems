<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Lab/Software Stack/System Call Wrapper/content/basic-syscall">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Analyzing the Software Stack | Operating Systems</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://localhost//operating-systems/Lab/Software Stack/System Call Wrapper/content/basic-syscall"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Analyzing the Software Stack | Operating Systems"><meta data-rh="true" name="description" content="To get a better grasp on how the software stack works, let&#x27;s do a bottom-up approach:"><meta data-rh="true" property="og:description" content="To get a better grasp on how the software stack works, let&#x27;s do a bottom-up approach:"><link data-rh="true" rel="canonical" href="http://localhost//operating-systems/Lab/Software Stack/System Call Wrapper/content/basic-syscall"><link data-rh="true" rel="alternate" href="http://localhost//operating-systems/Lab/Software Stack/System Call Wrapper/content/basic-syscall" hreflang="en"><link data-rh="true" rel="alternate" href="http://localhost//operating-systems/Lab/Software Stack/System Call Wrapper/content/basic-syscall" hreflang="x-default"><link rel="stylesheet" href="/operating-systems/assets/css/styles.17f22a47.css">
<link rel="preload" href="/operating-systems/assets/js/runtime~main.8d74a93b.js" as="script">
<link rel="preload" href="/operating-systems/assets/js/main.02fab441.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/operating-systems/"><div class="navbar__logo"><img src="/operating-systems/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/operating-systems/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">SO</b></a><a class="navbar__item navbar__link" href="/operating-systems/Introduction">Introduction</a><a class="navbar__item navbar__link" href="/operating-systems/Lecture">Lecture</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/operating-systems/Lab">Lab</a><a class="navbar__item navbar__link" href="/operating-systems/Assignments">Assignments</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Analyzing the Software Stack</h1><p>To get a better grasp on how the software stack works, let&#x27;s do a bottom-up approach:
we build and run different programs, that start off by using the system call API (the lowest layer in the software stack) and progressively use higher layers.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-calls-explained">System Calls Explained<a class="hash-link" href="#system-calls-explained" title="Direct link to heading">​</a></h2><p>A system call, or syscall for short, is a method used by applications to communicate with the operating system&#x27;s kernel.</p><p>The need for syscalls is tied to the modern operating systems model of conceptually separating into kernel space and user space.</p><p>The kernel space manages the hardware resources such as CPU, I/O devices, disk or memory.
Moreover, the kernel also provides an interface for the user space applications to interact with the hardware.</p><p>The user space is where you are running your applications and processes.
From the user space, we cannot directly access the hardware or perform privileged operations.
You need to use syscalls to perform privileged operations such as accessing the hardware.</p><p>Below, you can see some examples of system calls and what resource they request from the kernel:</p><ul><li><p><code>brk()</code> is used to allocate memory</p></li><li><p><code>open()</code> is used to access the file system and open a specific file</p></li><li><p><code>write()</code> is used to access the file system and modify the contents of a specific file</p></li></ul><p><img loading="lazy" alt="System Call API Explained" src="/operating-systems/assets/images/syscall-explained-c884ed051906c31957f8621ae87d3b2f.svg" width="403" height="405" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="basic-system-calls">Basic System Calls<a class="hash-link" href="#basic-system-calls" title="Direct link to heading">​</a></h2><p>The <code>support/basic-syscall/</code> folder stores the implementation of a simple program in assembly language for the x86_64 (64 bit) architecture.
The program invokes two system calls: <code>write</code> and <code>exit</code>.
The program is duplicated in two files using the two x86 assembly language syntaxes: the Intel / NASM syntax (<code>hello.asm</code>) and the AT&amp;T / GAS syntax (<code>hello.s</code>).</p><p>The implementation follows the <a href="https://x64.syscall.sh/" target="_blank" rel="noopener noreferrer">x86_64 Linux calling convention</a>:</p><ul><li>system call ID is passed in the <code>rax</code> register</li><li>system call arguments are passed, in order, in the <code>rdi</code>, <code>rsi</code>, <code>rdx</code>, <code>r10</code>, <code>r8</code>, <code>r9</code> registers</li></ul><p>Let&#x27;s build and run the two programs:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/basic-syscall$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello.asm  hello.s  Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/basic-syscall$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nasm -f elf64 -o hello-nasm.o hello.asm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc -nostdlib -no-pie -Wl,--entry=main -Wl,--build-id=none  hello-nasm.o   -o hello-nasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc -c -o hello-gas.o hello.s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc -nostdlib -no-pie -Wl,--entry=main -Wl,--build-id=none  hello-gas.o   -o hello-gas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/basic-syscall$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello.asm  hello-gas  hello-gas.o  hello-nasm  hello-nasm.o  hello.s  Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/basic-syscall$ ./hello-nasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello, world!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/basic-syscall$ ./hello-gas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello, world!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The two programs end up printing the <code>Hello, world!</code> message at standard output by issuing the <code>write</code> system call.
Then they complete their work by issuing the <code>exit</code> system call.</p><p>The <code>write</code> system call writes a buffer to the file referred by the first argument, which is the file descriptor.
File descriptors are going to be studied in-depth in future chapters.
For now, it is enough for you to know that they are integers that behave like file handlers.
The 3 most common file descriptors are:</p><ul><li><p><code>0</code> references the standard input (<code>stdin</code>)</p></li><li><p><code>1</code> references the standard output (<code>stdout</code>)</p></li><li><p><code>2</code> references the standard error (<code>stderr</code>)</p></li></ul><p>Use <code>man 2 write</code> and <code>man 3 exit</code> to get a detailed understanding of the syntax and use of the two system calls.
You can also check the online man pages: <a href="https://man7.org/linux/man-pages/man2/write.2.html" target="_blank" rel="noopener noreferrer"><code>write</code></a>, <a href="https://man7.org/linux/man-pages/man3/exit.3.html" target="_blank" rel="noopener noreferrer"><code>exit</code></a></p><p>We use <code>strace</code> to inspect system calls issued by a program:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../lab/support/basic-syscall$ strace ./hello-nasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">execve(&quot;./hello-nasm&quot;, [&quot;./hello-nasm&quot;], 0x7ffc4e175f00 /* 63 vars */) = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write(1, &quot;Hello, world!\n&quot;, 14Hello, world!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)         = 14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit(0)                                 = ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+++ exited with 0 +++</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are three system calls captured by <code>strace</code>:</p><ul><li><code>execve</code>: this is issued by the shell to create the new process;
you&#x27;ll find out more about <code>execve</code> in the &quot;Compute&quot; chapter</li><li><code>write</code>: called by the program to print <code>Hello, world!</code> to standard output</li><li><code>exit</code>: to exit the program</li></ul><p>This is the most basic program for doing system calls.
Given that system calls require a specific calling convention, their invocation can only be done in assembly language.
Obviously, this is not portable (specific to a given CPU architecture, x86_64 in our case) and too verbose and difficult to maintain.
For portability and maintainability, we require a higher level language, such as C.
In order to use C, we need function wrappers around system calls.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="practice">Practice<a class="hash-link" href="#practice" title="Direct link to heading">​</a></h3><p>Update the <code>hello.asm</code> and / or <code>hello.s</code> files to print both <code>Hello, world!</code> and <code>Bye, world!</code>.
This means adding another <code>write</code> system call.</p><p><a href="/operating-systems/Lab/Software Stack/System Call Wrapper/quiz/syscalls">Quiz</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#system-calls-explained" class="table-of-contents__link toc-highlight">System Calls Explained</a></li><li><a href="#basic-system-calls" class="table-of-contents__link toc-highlight">Basic System Calls</a><ul><li><a href="#practice" class="table-of-contents__link toc-highlight">Practice</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://curs.upb.ro" target="_blank" rel="noopener noreferrer" class="footer__link-item">Main site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ocw.cs.pub.ro/courses/so" target="_blank" rel="noopener noreferrer" class="footer__link-item">OCW<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/sisteme.de.operare/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 SO Team</div></div></div></footer></div>
<script src="/operating-systems/assets/js/runtime~main.8d74a93b.js"></script>
<script src="/operating-systems/assets/js/main.02fab441.js"></script>
</body>
</html>